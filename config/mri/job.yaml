apiVersion: batch/v1
kind: Job
metadata:
  name: resubmit-workflow
  annotations:
    kapp.k14s.io/update-strategy: always-replace
    kapp.k14s.io/change-group: "apps.big.co/argo-pipeline-job"
    kapp.k14s.io/change-rule: "upsert before upserting apps.big.co/argo-pipelines"
spec:
  template:
    spec:
      initContainers:
        - name: check-if-workflow-exists
          image: argoproj/argocli
          args: ["stop", "ml-image-processing-workflow-mri"]
      containers:
        - name: resubmit-workflow
          image: argoproj/argocli
          args: ["resubmit", "--log", "ml-image-processing-workflow-mri"]
      restartPolicy: Never
  backoffLimit: 0
  podFailurePolicy:
    rules:
      - action: Ignore
        onExitCodes:
          operator: NotIn
          values: [ 4200000 ]