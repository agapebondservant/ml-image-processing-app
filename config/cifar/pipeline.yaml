#@ load("@ytt:data", "data")
---
apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  name: ml-image-processing-workflow
spec:
  entrypoint: train
  templates:
    - name: train
      steps:
        - - name: upload-dataset
            template: main
            arguments:
              parameters:
                - name: mlflow_entry
                  value: "upload_dataset"
                - name: mlflow_stage
                  value: #@ data.values.model_stage
        - - name: train-model
            template: main
            arguments:
              parameters:
                - name: mlflow_entry
                  value: "train_model"
                - name: mlflow_stage
                  value: #@ data.values.model_stage
        - - name: evaluate-model
            template: main
            arguments:
              parameters:
                - name: mlflow_entry
                  value: "evaluate_model"
                - name: mlflow_stage
                  value: #@ data.values.model_stage
    - name: main
      inputs:
        parameters:
          - name: mlflow_entry
          - name: mlflow_stage
      container:
        image: oawofolu/ml-image-processor
        command: [sh, -c]
        args: ['whereis cat']